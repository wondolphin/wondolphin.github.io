<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>æ–¹å‘è»¢æ›ãƒ‘ã‚ºãƒ«ã‚²ãƒ¼ãƒ </title>
    <style>
        /* å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            margin: 0;
            padding: 10px; 
            background-color: #f0f2f5;
            color: #333;
            height: 100vh; /* â˜…å¤‰æ›´: é«˜ã•ã‚’ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆã«å›ºå®š */
            box-sizing: border-box; 
            overflow: hidden; /* â˜…è¿½åŠ : ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã‚’éè¡¨ç¤º */
            touch-action: none;
        }

        /* ã‚²ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒŠ */
        .main-container {
            display: flex;
            flex-wrap: nowrap; /* â˜…å¤‰æ›´: æŠ˜ã‚Šè¿”ã•ãªã„ */
            gap: 20px;
            align-items: flex-start;
            height: 100%; /* â˜…è¿½åŠ : è¦ªï¼ˆbodyï¼‰ã®é«˜ã•ã«åˆã‚ã›ã‚‹ */
            max-height: calc(100vh - 20px); /* â˜…å¤‰æ›´: bodyã®ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’è€ƒæ…® */
        }

        /* ç›¤é¢ */
        #game-board {
            /* â˜…å¤‰æ›´: é«˜ã•ã‚’åŸºæº–ã«ã‚µã‚¤ã‚ºã‚’æ±ºå®š (ã•ã‚‰ã«å°ã•ã) */
            height: calc(100vh - 120px); /* ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆã®é«˜ã•ã‹ã‚‰ä½™ç™½ã‚’å¼•ã */
            width: calc(100vh - 120px);  /* é«˜ã•ã¨åˆã‚ã›ã¦æ­£æ–¹å½¢ã‚’ç¶­æŒ */
            
            /* â˜…å¤‰æ›´: max-height/widthã¯500pxã®è«–ç†ã‚µã‚¤ã‚ºã«åˆã‚ã›ã‚‹ */
            max-height: 500px;
            max-width: 500px;

            border: 2px solid #333;
            position: relative;
            background-color: #fff;
            background-image:
                linear-gradient(rgba(0, 0, 0, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 0, 0, 0.1) 1px, transparent 1px);
            /* â˜…å¤‰æ›´: background-sizeã‚‚å‹•çš„ã«å¤‰æ›´ï¼ˆJSå´ã§ï¼‰ */
            /* background-size: 40px 40px; */ 
            overflow: hidden; /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã¯ã¿å‡ºã•ãªã„ã‚ˆã†ã« */
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        /* ã‚µã‚¤ãƒ‰ãƒ‘ãƒãƒ« */
        .side-panel {
            width: 260px; /* â˜…å¤‰æ›´: å›ºå®šã‚µã‚¤ã‚ºã«æˆ»ã™ */
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);

            /* â˜…å¤‰æ›´: ç›¤é¢ã¨é«˜ã•ã‚’åˆã‚ã›ã‚‹ (ã•ã‚‰ã«å°ã•ã) */
            height: calc(100vh - 120px); /* ç›¤é¢ã¨åŒã˜ */
            max-height: 500px; /* ç›¤é¢ã¨åŒã˜ */
            box-sizing: border-box; /* â˜…è¿½åŠ : ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’é«˜ã•ã«å«ã‚ã‚‹ */
            
            overflow-y: auto;
            overflow-x: hidden;
        }

        .side-panel h3 {
            margin: 0;
            padding-bottom: 5px; /* â˜…å¤‰æ›´: ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’æ¸›ã‚‰ã™ */
            border-bottom: 1px solid #eee;
            text-align: center;
            font-size: 1.0em; /* â˜…å¤‰æ›´: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º */
        }
        
        #level-selection h3 {
            font-size: 0.8em; /* â˜…å¤‰æ›´: ãƒ•ã‚©ãƒ³ãƒˆã‚’å°ã•ã */
            padding-bottom: 2px;
            margin-bottom: 5px;
            gap: 5px; /* â˜…å¤‰æ›´: ã‚®ãƒ£ãƒƒãƒ—ã‚’å°ã•ã */
        }
        
        /* ã‚¹ã‚¿ãƒ³ãƒã‚¤ã‚¨ãƒªã‚¢ */
        #standby-area {
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 10px; 
            padding: 10px; 
            min-height: 100px;
            background-color: #f9f9f9;
            border: 1px dashed #ccc;
            border-radius: 6px;
            align-items: start;
            justify-items: center;
        }

        /* ã‚²ãƒ¼ãƒ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        .game-object {
            position: absolute;
            /* width/heightã¯JSã§å‹•çš„ã«è¨­å®š */
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 14px;
            box-sizing: border-box;
            background-size: contain; 
            background-repeat: no-repeat;
            background-position: center;
        }

        /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ */
        #player {
            background-image: url('player.png'); 
            z-index: 10;
            transform: rotate(calc(var(--angle, 0) * 1deg)); 
            transition: transform 0.05s linear; 
            border-radius: 50%;
        }

        @keyframes shake {
            0%, 100% { transform: rotate(calc(var(--angle, 0) * 1deg)) translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: rotate(calc(var(--angle, 0) * 1deg)) translateX(-5px); }
            20%, 40%, 60%, 80% { transform: rotate(calc(var(--angle, 0) * 1deg)) translateX(5px); }
        }
        #player.hit-wall {
            animation: shake 0.5s ease-in-out;
        }


        /* ã‚´ãƒ¼ãƒ« */
        .goal {
            background-image: url('goal.png'); 
            border-radius: 50%; 
        }

        /* å£ */
        .wall {
            background-color: #777;
            z-index: 5;
            border-radius: 4px;
        }
        
        /* æ–¹å‘è»¢æ›ãƒ–ãƒ­ãƒƒã‚¯ */
        .direction-block {
            cursor: grab;
            position: relative; 
            z-index: 8;
            user-select: none; 
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: opacity 0.3s ease; 
            /* width/heightã¯JSã§å‹•çš„ã«è¨­å®š */
        }
        .direction-block.placed {
             position: absolute; 
        }
        .direction-block:active {
            cursor: grabbing;
            z-index: 20; 
        }
        .direction-block.hit { 
            opacity: 0.4; 
            cursor: default;
        }
        
        /* ãƒœã‚¿ãƒ³ */
        .button {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.2s, transform 0.1s;
            user-select: none; 
        }
        .button:active {
            transform: translateY(1px);
        }

        #go-button {
            background-color: #50e3c2;
            color: white;
        }
        #go-button:hover {
            background-color: #45c4a8;
        }
        #go-button:disabled, #reset-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
        }


        #reset-button {
            background-color: #f0f2f5;
            color: #555;
            border: 1px solid #ddd;
        }
         #reset-button:hover:not(:disabled) { 
            background-color: #e6e8eb;
        }


        /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚¨ãƒªã‚¢ */
        #message-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.0); 
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            border-radius: 8px;
        }
        #message-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }

        .message-box {
            background-color: rgba(255, 255, 255, 0.9); 
            color: #333;
            padding: 30px 50px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .message-box .button { 
            background-color: #50e3c2;
            color: white;
        }
        .message-box .button:hover {
            background-color: #45c4a8;
        }

        /* ãƒ¬ãƒ™ãƒ«é¸æŠUI (ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³) */
        #level-selection {
            display: flex;
            flex-direction: column;
            gap: 5px; 
        }
        #level-dropdown {
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: 14px;
            background-color: white;
        }

        /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è»Œè·¡ */
        .trail {
            position: absolute;
            /* width/heightã¯JSã§å‹•çš„ã«è¨­å®š */
            background-color: rgba(0, 0, 200, 0.3);
            border-radius: 50%;
            z-index: 1;
        }

    </style>
</head>
<body>

    <div class="main-container">
        <div id="game-board">
             <div id="message-overlay"></div>
        </div>
        <div class="side-panel">
            <div id="level-selection">
                <!-- ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã¯JSã§ã“ã“ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
            </div>
            <h3>ãƒ–ãƒ­ãƒƒã‚¯</h3>
            <div id="standby-area">
                <!-- ãƒ–ãƒ­ãƒƒã‚¯ã¯JSã§ã“ã“ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
            </div>
            <button id="go-button" class="button">Go!</button>
            <button id="reset-button" class="button">ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
    </div>

    <script>
        // --- ã‚²ãƒ¼ãƒ è¨­å®š ---
        const LOGICAL_BOARD_SIZE = 500; // â˜…å¤‰æ›´: è«–ç†çš„ãªç›¤é¢ã‚µã‚¤ã‚º
        const PLAYER_SPEED = 8;
        const PLAYER_SLOW_SPEED = 3; 
        const OBJECT_SIZE = 40; // è«–ç†çš„ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚µã‚¤ã‚º
        const STANDBY_BLOCK_SIZE = 55; // è«–ç†çš„ãªã‚¹ã‚¿ãƒ³ãƒã‚¤ãƒ–ãƒ­ãƒƒã‚¯ã‚µã‚¤ã‚º

        // --- ãƒ¬ãƒ™ãƒ«ãƒ‡ãƒ¼ã‚¿ (500x500ã®è«–ç†åº§æ¨™) ---
             const levels = [
             {
    player: { x: 378, y: 412, angle: 0 },
    goals: [
        { x: 110, y: 142 },
    ],
    walls: [
        { x: 102, y: 254, w: 179, h: 196 },
    ],
    blocks: [
        { angle: 90 },
    ]
},
                {
                    player: { x: 74, y: 402, angle: 0 },
                    goals: [
                        { x: 367, y: 58 },
                    ],
                    walls: [
                        { x: 222, y: 2, w: 30, h: 160 },
                        { x: 223, y: 307, w: 30, h: 184 },
                    ],
                    blocks: [
                        { angle: 90 },
                        { angle: -90 },
                    ]
                },
                
                                {
                    player: { x: 234, y: 229, angle: 180 },
                    goals: [
                        { x: 230, y: 29 },
                    ],
                    walls: [
                        { x: 145, y: 134, w: 211, h: 39 },
                    ],
                    blocks: [
                        { angle: -90 },
                        { angle: -90 },
                        { angle: -90 },
                    ]
                },
                                {
                    player: { x: 35, y: 33, angle: 90 },
                    goals: [
                        { x: 235, y: 387 },
                    ],
                    walls: [
                        { x: 198, y: 187, w: 100, h: 40 },
                    ],
                    blocks: [
                        { angle: -45 },
                        { angle: -90 },
                    ]
                },
                
{
    player: { x: 55, y: 407, angle: 45 },
    goals: [
        { x: 55, y: 55 },
        { x: 305, y: 305 },
        { x: 155, y: 155 },
        { x: 405, y: 405 },
    ],
    walls: [
    ],
    blocks: [
        { angle: 135 },
        { angle: 135 },
    ]
},
                                               
                {
    player: { x: 80, y: 382, angle: 0 },
    goals: [
        { x: 231, y: 231 },
        { x: 83, y: 231 },
        { x: 386, y: 228 },
    ],
    walls: [
        { x: 139, y: 225, w: 20.5, h: 134 },
        { x: 339, y: 99, w: 26.5, h: 118 },
    ],
    blocks: [
        { angle: 135 },
        { angle: -135 },
    ]
},

/*
 {
                    player: { x: 35, y: 427, angle: 45 },
                    goals: [
                        { x: 425, y: 275 },
                        { x: 176, y: 179 },
                        { x: 34, y: 286 },
                    ],
                    walls: [
                    ],
                    blocks: [
                        { angle: -135 },
                        { angle: -135 },
                        { angle: 135 },
                    ]
                },
                */

                
{
                    player: { x: 61, y: 435, angle: 0 },
                    goals: [
                        { x: 394, y: 44 },
                    ],
                    walls: [
                        { x: 135, y: 10, w: 98.5, h: 114 },
                        { x: 215, y: 125, w: 98.5, h: 109 },
                        { x: 373, y: 381, w: 97.5, h: 106 },
                    ],
                    blocks: [
                        { angle: -135 },
                        { angle: 90 },
                        { angle: 45 },
                    ]
                },
{
    player: { x: 405, y: 355, angle: 0 },
    goals: [
        { x: 55, y: 55 },
        { x: 405, y: 55 },
    ],
    walls: [
        { x: 242, y: 0, w: 20, h: 397 },
    ],
    blocks: [
        { angle: -180 },
        { angle: -90 },
        { angle: -90 },
    ]
},

                {
    player: { x: 230, y: 427, angle: 0 },
    goals: [
        { x: 236, y: 130 },
        { x: 135, y: 328 },
    ],
    walls: [
        { x: 147, y: 240, w: 153.5, h: 20 },
        { x: 143, y: 44, w: 214.5, h: 20 },
        { x: 124, y: 47, w: 49, h: 194 },
    ],
    blocks: [
        { angle: 180 },
        { angle: 90 },
        { angle: 135 },
    ]
},
{
    player: { x: 34, y: 434, angle: 90 },
    goals: [
        { x: 27, y: 29 },
        { x: 258, y: 227 },
        { x: 428, y: 226 },
    ],
    walls: [
        { x: 0, y: 101, w: 230, h: 280 },
        { x: 328, y: 99, w: 63, h: 286 },
    ],
    blocks: [
        { angle: 90 },
        { angle: -90 },
        { angle: 180 },
        { angle: 90 },
    ]
},
{
    player: { x: 381, y: 82, angle: 270 },
    goals: [
        { x: 227, y: 84 },
        { x: 236, y: 227 },
        { x: 234, y: 371 },
        { x: 87, y: 232 },
    ],
    walls: [
    ],
    blocks: [
        { angle: -135 },
        { angle: 135 },
        { angle: -90 },
    ]
},
 {
                    player: { x: 330, y: 377, angle: 0 },
                    goals: [
                        { x: 229, y: 434 },  { x: 329, y: 434 },
                    ],
                    walls: [
                        { x: 171, y: 268, w: 138, h: 52 },
                    ],
                    blocks: [
                        { angle: 45 },
                        { angle: 90 },
                        { angle: 135 },
                    ]
                },
{
    player: { x: 30, y: 285, angle: 90 },
    goals: [
        { x: 81, y: 179 },
        { x: 234, y: 327 },
        { x: 336, y: 177 },
    ],
    walls: [
        { x: 250, y: 93, w: 49, h: 154 },
    ],
    blocks: [
        { angle: 180 },
        { angle: 135 },
        { angle: 135 },
    ]
},
{
    player: { x: 229, y: 438, angle: 0 },
    goals: [
        { x: 129, y: 235 },
        { x: 133, y: 128 },
        { x: 329, y: 236 },
        { x: 331, y: 131 },
    ],
    walls: [
        { x: 236, y: 149, w: 30.5, h: 102 },
        { x: 204, y: 190, w: 98.5, h: 23 },
    ],
    blocks: [
        { angle: 45 },
        { angle: -90 },
        { angle: -90 },
        { angle: -90 },
    ]
},
               
{
    player: { x: 406, y: 460, angle: 0 },
    goals: [
        { x: 393, y: 231 },
        { x: 73, y: 229 },
        { x: 231, y: 382 },
        { x: 233, y: 77 },
    ],
    walls: [
    ],
    blocks: [
        { angle: 135 },
        { angle: -135 },
        { angle: 135 },
    ]
},
                                {
                    player: { x: 423, y: 424, angle: 0 },
                    goals: [
                        { x: 27, y: 428 },
                    ],
                    walls: [
                        { x: 116, y: 209, w: 254, h: 51 },
                        { x: 302, y: 396, w: 72, h: 104 },
                        { x: 116, y: 272, w: 66, h: 111 },
                        { x: 376, y: 152, w: 33, h: 108 },
                        { x: 0, y: 0, w: 248, h: 110 },
                    ],
                    blocks: [
                        { angle: 135 },
                        { angle: -45 },
                        { angle: 90 },
                    ]
                },
                
                /*
                {
                    player: { x: 234, y: 286, angle: 0 },
                    goals: [
                        { x: 128, y: 129 },
                    ],
                    walls: [
                        { x: 73, y: 203, w: 120, h: 112 },
                        { x: 191, y: 87, w: 118.5, h: 109 },
                    ],
                    blocks: [
                        { angle: -90 },
                        { angle: -135 },
                        { angle: -135 },
                        { angle: -135 },
                    ]
                },
                */
                
                
                {
    player: { x: 109, y: 435, angle: 0 },
    goals: [
        { x: 330, y: 118 },
        { x: 411, y: 431 },
    ],
    walls: [
        { x: 212, y: 385, w: 79, h: 100 },
        { x: 66, y: 12, w: 108, h: 79.5 },
    ],
    blocks: [
        { angle: -60 },
        { angle: -120 },
    ]
},
                {
                    player: { x: 307, y: 446, angle: 90 },
                    goals: [
                        { x: 28, y: 283 },
                    ],
                    walls: [
                        { x: 215, y: 128, w: 68, h: 372 },
                        { x: 0, y: 129, w: 97, h: 47 },
                        { x: 357, y: 231, w: 74, h: 153 },
                        { x: 424, y: 0, w: 76, h: 124 },
                    ],
                    blocks: [
                        { angle: 90 },
                        { angle: 90 },
                        { angle: 60 },
                    ]
                },
                
                 {
    player: { x: 336, y: 34, angle: -90 },
    goals: [
        { x: 414, y: 420 },
    ],
    walls: [
        { x: 229, y: 338, w: 46, h: 162 },
        { x: 192, y: 108, w: 247, h: 54 },
    ],
    blocks: [
        { angle: 90 },
        { angle: -90 },
        { angle: 120 },
    ]
},
 {
                    player: { x: 35, y: 33, angle: 90 },
                    goals: [
                        { x: 228, y: 334 },
                        { x: 128, y: 179 },
                    ],
                    walls: [
                    ],
                    blocks: [
                        { angle: -90 },
                        { angle: -45 },
                        { angle: -135 },
                    ]
                },
                
                                {
                    player: { x: 226, y: 245, angle: 0 },
                    goals: [
                        { x: 33, y: 449 },
                    ],
                    walls: [
                        { x: 109, y: 260, w: 98.5, h: 114 },
                    ],
                    blocks: [
                        { angle: -60 },
                        { angle: 150 },
                        { angle: 90 },
                    ]
                },
{
    player: { x: 226, y: 137, angle: 180 },
    goals: [
        { x: 382, y: 30 },
        { x: 78, y: 30 },
    ],
    walls: [
        { x: 195, y: 0, w: 106, h: 97 },
    ],
    blocks: [
        { angle: -135 },
        { angle: 150 },
        { angle: 120 },
    ]
},
                {
                    player: { x: 54, y: 67, angle: 180 },
                    goals: [
                        { x: 411, y: 135 },
                        { x: 414, y: 421 },
                        { x: 208, y: 42 },
                    ],
                    walls: [
                    ],
                    blocks: [
                        { angle: 120 },
                        { angle: -120 },
                        { angle: -150 },
                    ]
                },

                {
                    player: { x: 430, y: 280, angle: 0 },
                    goals: [
                        { x: 430, y: 330 },
                    ],
                    walls: [
                        { x: 153, y: 151, w: 206.5, h: 185 },
                    ],
                    blocks: [
                        { angle: 60 },
                        { angle: 60 },
                        { angle: 60 },
                        { angle: 60 },
                        { angle: 60 },
                    ]
                },
                {
                    player: { x: 69, y: 367, angle: 30 },
                    goals: [
                        { x: 104, y: 455 },
                    ],
                    walls: [
                    ],
                    blocks: [
                        { angle: -135 },
                        { angle: -135 },
                        { angle: -135 },
                        { angle: -135 },
                    ]
                },
                {
                    player: { x: 85, y: 340, angle: 30 },
                    goals: [
                        { x: 230, y: 228 },
                        { x: 78, y: 231 },
                        { x: 383, y: 229 },
                    ],
                    walls: [
                    ],
                    blocks: [
                        { angle: -150 },
                        { angle: 150 },
                        { angle: 120 },
                    ]
                },
               
                


               
                {
                    player: { x: 232, y: 230, angle: 315 },
                    goals: [
                        { x: 130, y: 134 },
                        { x: 33, y: 225 },
                        { x: 133, y: 333 },
                        { x: 336, y: 336 },
                        { x: 431, y: 232 },
                    ],
                    walls: [
                    ],
                    blocks: [
                        { angle: 135 },
                        { angle: 135 },
                        { angle: -135 },
                        { angle: -135 },
                    ]
                },
                
                {
                    player: { x: 232, y: 234, angle: 0 },
                    goals: [
                        { x: 232, y: 135 },
                        { x: 130, y: 135 },
                        { x: 340, y: 135 },
                    ],
                    walls: [
                    ],
                    blocks: [
                        { angle: -180 },
                        { angle: 90 },
                        { angle: 135 },
                        { angle: -135 },
                        { angle: -135 },
                    ]
                },
                {
    player: { x: 36, y: 129, angle: 180 },
    goals: [
        { x: 28, y: 29 },
    ],
    walls: [
        { x: 112, y: 94, w: 124, h: 108 },
        { x: 258, y: 277, w: 140, h: 123 },
    ],
    blocks: [
        { angle: 45 },
        { angle: 60 },
        { angle: 150 },
        { angle: -45 },
        { angle: 60 },
    ]
},







{
    player: { x: 230, y: 230, angle: 45 },
    goals: [
        { x: 405, y: 405 },
        { x: 55, y: 55 },
        { x: 405, y: 55 },
    ],
    walls: [
    ],
    blocks: [
        { angle: -180 },
        { angle: -180 },
        { angle: -135 },
        { angle: 90 },
    ]
},
{
    player: { x: 230, y: 230, angle: 0 },
    goals: [
        { x: 30, y: 427 },
        { x: 27, y: 28 },
        { x: 391, y: 37 },
        { x: 391, y: 428 },
    ],
    walls: [
        { x: 288, y: 223, w: 46, h: 162 },
        { x: 110, y: 160, w: 66, h: 230 },
        { x: 287, y: 0, w: 46, h: 102 },
    ],
    blocks: [
        { angle: -90 },
        { angle: -60 },
        { angle: 90 },
        { angle: -150 },
        { angle: 120 },
    ]
}


                
                
                
                
                
                
            ];


        // --- DOMè¦ç´ ã®å–å¾— ---
        const gameBoard = document.getElementById('game-board');
        let BOARD_SIZE = gameBoard.clientWidth; // â˜…å¤‰æ›´: ç›¤é¢ã®*å®Ÿéš›*ã®ãƒ”ã‚¯ã‚»ãƒ«ã‚µã‚¤ã‚º
        let scaleFactor = 1.0; // â˜…è¿½åŠ : è«–ç†ã‚µã‚¤ã‚ºã¨å®Ÿéš›ã‚µã‚¤ã‚ºã®æ¯”ç‡

        const standbyArea = document.getElementById('standby-area');
        const goButton = document.getElementById('go-button');
        const resetButton = document.getElementById('reset-button');
        const messageOverlay = document.getElementById('message-overlay');
        const levelSelectionDiv = document.getElementById('level-selection');

        // --- ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹ç®¡ç† ---
        let player, goals = [], walls = [], placedBlocks = [];
        let gameState = 'standby'; // 'standby' or 'playing'
        let animationFrameId;
        let currentLevelIndex = 0; // ç¾åœ¨ã®ãƒ¬ãƒ™ãƒ«
        let levelClearStatus = {}; // ãƒ¬ãƒ™ãƒ«ã‚¯ãƒªã‚¢çŠ¶æ…‹ (â˜…ãƒãƒ¼ã‚¯ç”¨)
        let playerTrail = []; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è»Œè·¡

        // --- ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—é–¢é€£ã®å¤‰æ•° ---
        let draggedElement = null;
        let offsetX, offsetY;

        // --- åˆæœŸåŒ–å‡¦ç† ---
        function init(levelIndex = 0) {
            // â˜…è¿½åŠ : ç›¤é¢ã‚µã‚¤ã‚ºã¨ç¸®å°ºã‚’å‹•çš„ã«æ›´æ–°
            BOARD_SIZE = gameBoard.clientWidth; 
            scaleFactor = BOARD_SIZE / LOGICAL_BOARD_SIZE;
            
            // â˜…è¿½åŠ : ç›¤é¢ã®ãƒã‚¹ç›®ã‚µã‚¤ã‚ºã‚‚ç¸®å°ºã«åˆã‚ã›ã‚‹
            gameBoard.style.backgroundSize = `${40 * scaleFactor}px ${40 * scaleFactor}px`;

            cancelAnimationFrame(animationFrameId); 
            clearTrail(); 
            
            currentLevelIndex = levelIndex;
            const currentLevel = levels[currentLevelIndex];

            gameBoard.innerHTML = ''; 
            gameBoard.appendChild(messageOverlay); 
            standbyArea.innerHTML = '';
            placedBlocks = [];
            goals = [];
            walls = []; 

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä½œæˆ (â˜…createGameObjectãŒã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°)
            const playerConfig = currentLevel.player;
            player = createGameObject('player', playerConfig.x, playerConfig.y, OBJECT_SIZE, OBJECT_SIZE);
            player.angle = playerConfig.angle;
            player.overlappingBlock = null;
            player.lastDistanceToBlock = Infinity;
            updatePlayerTransform(); 

            // ã‚´ãƒ¼ãƒ«ã®ä½œæˆ (è¤‡æ•°)
            currentLevel.goals.forEach((goalConfig, index) => {
                const goal = createGameObject(`goal-${index} goal game-object`, goalConfig.x, goalConfig.y, OBJECT_SIZE, OBJECT_SIZE);
                goal.hit = false; 
                goals.push(goal);
            });

            // å£ã®ä½œæˆ
            walls = currentLevel.walls.map((w, index) => 
                createGameObject(`wall-${index} wall game-object`, w.x, w.y, w.w, w.h, false)
            );

            // ã‚¹ã‚¿ãƒ³ãƒã‚¤ã‚¨ãƒªã‚¢ã«æ–¹å‘è»¢æ›ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½œæˆ
            currentLevel.blocks.forEach((blockInfo, index) => {
                const block = document.createElement('div');
                block.id = `standby-block-${index}`; 
                block.className = 'direction-block game-object';
                
                const angle = blockInfo.angle;
                const sign = angle > 0 ? 'plus' : 'minus';
                const angleValue = Math.abs(angle);
                const filename = `math_direction_${sign}_${angleValue}.png`;
                block.style.backgroundImage = `url('${filename}')`;
                
                block.dataset.angle = blockInfo.angle;
                // â˜…å¤‰æ›´: ã‚¹ã‚¿ãƒ³ãƒã‚¤æ™‚ã®ã‚µã‚¤ã‚ºã‚‚ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ï¼ˆãŸã ã—åŸºæº–ã¯å›ºå®šå€¤ï¼‰
                const scaledStandbySize = STANDBY_BLOCK_SIZE; // (ã‚µã‚¤ãƒ‰ãƒ‘ãƒãƒ«ã¯ç¸®å°ã—ãªã„å‰æ)
                block.style.width = `${scaledStandbySize}px`;
                block.style.height = `${scaledStandbySize}px`;
                block.dataset.radius = scaledStandbySize / 2; 
                block.style.position = 'relative'; 
                block.style.left = 'auto';
                block.style.top = 'auto';
                block.addEventListener('mousedown', onDragStart, false);
                block.addEventListener('touchstart', onDragStart, false);
                standbyArea.appendChild(block);
            });
            
            renderLevelDropdown();
            resetToStandby();
        }

        // --- â˜…å¤‰æ›´: ã‚²ãƒ¼ãƒ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆé–¢æ•° (ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°å¯¾å¿œ) ---
        function createGameObject(idOrClass, x, y, w, h, isCircle = true) {
            const el = document.createElement('div');
            if (idOrClass.includes(' ')) {
                el.className = idOrClass;
            } else {
                el.id = idOrClass;
                el.className = `${idOrClass} game-object`;
            }

            // â˜…è¿½åŠ : è«–ç†åº§æ¨™/ã‚µã‚¤ã‚ºã‚’ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
            const scaledX = x * scaleFactor;
            const scaledY = y * scaleFactor;
            const scaledW = w * scaleFactor;
            const scaledH = h * scaleFactor;

            el.style.width = `${scaledW}px`;
            el.style.height = `${scaledH}px`;
            el.style.left = `${scaledX}px`;
            el.style.top = `${scaledY}px`;
            
            if (isCircle) {
                // â˜…å¤‰æ›´: åŠå¾„ã‚‚ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
                el.dataset.radius = (w / 2) * scaleFactor;
            }
            // â˜…è¿½åŠ : è«–ç†åº§æ¨™ã‚’ãƒ‡ãƒ¼ã‚¿å±æ€§ã¨ã—ã¦ä¿æŒï¼ˆãƒ‰ãƒ©ãƒƒã‚°ç”¨ï¼‰
            el.dataset.logicalX = x;
            el.dataset.logicalY = y;
            
            gameBoard.appendChild(el);
            return el;
        }

        // --- ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç† (ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°å¯¾å¿œ) ---
        function onDragStart(e) {
            if (gameState !== 'standby' || draggedElement) return;

            const touch = e.touches ? e.touches[0] : null;
            const clientX = touch ? touch.clientX : e.clientX;
            const clientY = touch ? touch.clientY : e.clientY;

            draggedElement = e.target;

            if (draggedElement.parentElement === standbyArea) {
                e.preventDefault(); 
                draggedElement.classList.add('placed'); 
                draggedElement.style.position = 'absolute'; 
                draggedElement.style.opacity = '0.7'; 
                
                // â˜…å¤‰æ›´: ç›¤é¢ä¸Šã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚µã‚¤ã‚ºã«ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
                const scaledObjectSize = OBJECT_SIZE * scaleFactor;
                draggedElement.style.width = `${scaledObjectSize}px`;
                draggedElement.style.height = `${scaledObjectSize}px`;
                draggedElement.dataset.radius = scaledObjectSize / 2;
                
                const boardRect = gameBoard.getBoundingClientRect();
                // â˜…å¤‰æ›´: ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚‚ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
                offsetX = scaledObjectSize / 2;
                offsetY = scaledObjectSize / 2;
                
                let scaledX = clientX - boardRect.left - offsetX;
                let scaledY = clientY - boardRect.top - offsetY;

                // ç›¤é¢å†…ã«åã‚ã‚‹
                scaledX = Math.max(0, Math.min(scaledX, BOARD_SIZE - scaledObjectSize));
                scaledY = Math.max(0, Math.min(scaledY, BOARD_SIZE - scaledObjectSize));
                
                draggedElement.style.left = `${scaledX}px`;
                draggedElement.style.top = `${scaledY}px`;
                // â˜…å¤‰æ›´: è«–ç†åº§æ¨™ã‚’ä¿å­˜
                draggedElement.dataset.logicalX = scaledX / scaleFactor;
                draggedElement.dataset.logicalY = scaledY / scaleFactor;

                gameBoard.appendChild(draggedElement); 
                placedBlocks.push(draggedElement); 

            } else if (draggedElement.classList.contains('placed')) {
                e.preventDefault(); 
                draggedElement.style.opacity = '0.7';
                const rect = draggedElement.getBoundingClientRect();
                offsetX = clientX - rect.left;
                offsetY = clientY - rect.top;
            } else {
                draggedElement = null;
                return;
            }

            draggedElement.style.zIndex = 1000;
            document.addEventListener('mousemove', onDragMove, false);
            document.addEventListener('touchmove', onDragMove, false);
            document.addEventListener('mouseup', onDragEnd, false);
            document.addEventListener('touchend', onDragEnd, false);
        }

        function onDragMove(e) {
            if (!draggedElement) return;
            e.preventDefault(); 

            const touch = e.touches ? e.touches[0] : null;
            const clientX = touch ? touch.clientX : e.clientX;
            const clientY = touch ? touch.clientY : e.clientY;

            const boardRect = gameBoard.getBoundingClientRect();
            let scaledX = clientX - boardRect.left - offsetX;
            let scaledY = clientY - boardRect.top - offsetY;

            // â˜…å¤‰æ›´: å®Ÿéš›ã®å¹…/é«˜ã•ã‚’å–å¾—
            const scaledW = parseFloat(draggedElement.style.width);
            const scaledH = parseFloat(draggedElement.style.height);

            scaledX = Math.max(0, Math.min(scaledX, BOARD_SIZE - scaledW));
            scaledY = Math.max(0, Math.min(scaledY, BOARD_SIZE - scaledH));

            draggedElement.style.left = `${scaledX}px`;
            draggedElement.style.top = `${scaledY}px`;
            
            // â˜…å¤‰æ›´: è«–ç†åº§æ¨™ã‚’æ›´æ–°
            draggedElement.dataset.logicalX = scaledX / scaleFactor;
            draggedElement.dataset.logicalY = scaledY / scaleFactor;
        }

        function onDragEnd(e) {
            if (!draggedElement) return;
            
            draggedElement.style.zIndex = 8;
            draggedElement.style.opacity = '1'; 
            
            document.removeEventListener('mousemove', onDragMove, false);
            document.removeEventListener('touchmove', onDragMove, false);
            document.removeEventListener('mouseup', onDragEnd, false);
            document.removeEventListener('touchend', onDragEnd, false);
            
            draggedElement = null;
        }


        // --- ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ ---
        function startGame() {
            if (gameState !== 'standby') return;
            gameState = 'playing';
            clearTrail(); 

            // â˜…å¤‰æ›´: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®åˆæœŸä½ç½®ã‚‚ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
            const playerConfig = levels[currentLevelIndex].player;
            player.style.left = `${playerConfig.x * scaleFactor}px`;
            player.style.top = `${playerConfig.y * scaleFactor}px`;
            player.angle = playerConfig.angle;
            player.overlappingBlock = null;
            player.lastDistanceToBlock = Infinity;
            updatePlayerTransform();

            goButton.disabled = true;
            resetButton.disabled = true; 

            placedBlocks.forEach(block => {
                block.hit = false;
                block.classList.remove('hit'); 
            });

            goals.forEach(goal => {
                goal.hit = false;
                goal.style.display = 'flex'; 
            });
            
            hideMessage(); 
            gameLoop();
        }

        function gameLoop() {
            // â˜…å¤‰æ›´: é€Ÿåº¦ã‚‚ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
            const currentLogicalSpeed = player.overlappingBlock ? PLAYER_SLOW_SPEED : PLAYER_SPEED;
            const currentSpeed = currentLogicalSpeed * scaleFactor;

            const rad = (player.angle - 90) * (Math.PI / 180); 
            
            const currentX = parseFloat(player.style.left);
            const currentY = parseFloat(player.style.top);

            const newX = currentX + currentSpeed * Math.cos(rad);
            const newY = currentY + currentSpeed * Math.sin(rad);

            player.style.left = `${newX}px`;
            player.style.top = `${newY}px`;
            
            updateTrail(newX, newY); // è»Œè·¡ã‚’æ›´æ–°

            if (checkCollisions()) {
                return;
            }

            animationFrameId = requestAnimationFrame(gameLoop);
        }
        
        function updatePlayerTransform() {
             player.style.setProperty('--angle', player.angle);
        }

        // --- è¡çªåˆ¤å®š (ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã•ã‚ŒãŸå€¤ã§å®Ÿè¡Œ) ---
        function checkCollisions() {
            const pRect = player.getBoundingClientRect();
            const boardRect = gameBoard.getBoundingClientRect();
            
            // ç›¤é¢ã®å£ã¨ã®è¡çª
            if (pRect.left < boardRect.left - 1 || pRect.right > boardRect.right + 1 ||
                pRect.top < boardRect.top - 1 || pRect.bottom > boardRect.bottom + 1) {
                handleFailure(); 
                return true;
            }

            // å£ãƒ–ãƒ­ãƒƒã‚¯ã¨ã®è¡çª (å†† vs å››è§’å½¢)
            for (const wall of walls) {
                if (isCircleRectOverlap(player, wall)) {
                    handleFailure(); 
                    return true;
                }
            }
            
            // ã‚´ãƒ¼ãƒ«ã¨ã®è¡çª (è¤‡æ•°å¯¾å¿œ)
            let allGoalsHit = true;
            for (const goal of goals) {
                if (!goal.hit) {
                    if (isCircleOverlap(player, goal)) {
                        goal.hit = true;
                        goal.style.display = 'none'; // ã‚´ãƒ¼ãƒ«ã‚’æ¶ˆã™
                    } else {
                        allGoalsHit = false; // ã¾ã ãƒ’ãƒƒãƒˆã—ã¦ã„ãªã„ã‚´ãƒ¼ãƒ«ãŒã‚ã‚‹
                    }
                }
            }
            
            if (allGoalsHit) {
                handleClear();
                return true;
            }

            // æ–¹å‘è»¢æ›ãƒ–ãƒ­ãƒƒã‚¯ã¨ã®è¡çªãƒ­ã‚¸ãƒƒã‚¯
            if (player.overlappingBlock) {
                const currentDistance = getDistance(player, player.overlappingBlock);
                
                // â˜…å¤‰æ›´: åˆ¤å®šè·é›¢ã‚‚ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
                const triggerDistance = ((PLAYER_SLOW_SPEED / 2) + 1) * scaleFactor;

                if (isCircleOverlap(player, player.overlappingBlock, true)) { 
                    if (currentDistance < triggerDistance || currentDistance > player.lastDistanceToBlock) {
                        player.angle -= parseInt(player.overlappingBlock.dataset.angle); 
                        updatePlayerTransform();
                        player.overlappingBlock.hit = true;
                        player.overlappingBlock.classList.add('hit'); 
                        player.overlappingBlock.style.opacity = '0.4';
                        
                        player.overlappingBlock = null; 
                        player.lastDistanceToBlock = Infinity;
                    } else {
                        player.lastDistanceToBlock = currentDistance;
                    }
                } else {
                    player.overlappingBlock = null; 
                    player.lastDistanceToBlock = Infinity;
                }
            } else {
                for (const block of placedBlocks) {
                    if (!block.hit && isCircleOverlap(player, block, true)) { 
                        player.overlappingBlock = block; 
                        player.lastDistanceToBlock = getDistance(player, block);
                        break; 
                    }
                }
            }
            return false;
        }
        
        // â˜…å¤‰æ›´: å††ã¨å››è§’å½¢ã®è¡çªåˆ¤å®š (ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã•ã‚ŒãŸstyleå€¤ã‚’ä½¿ç”¨)
        function isCircleRectOverlap(circle, rect) {
            const circleRadius = parseFloat(circle.dataset.radius); // Scaled
            const circleX = parseFloat(circle.style.left) + circleRadius; // Scaled
            const circleY = parseFloat(circle.style.top) + circleRadius; // Scaled

            const rectX = parseFloat(rect.style.left); // Scaled
            const rectY = parseFloat(rect.style.top); // Scaled
            const rectW = parseFloat(rect.style.width); // Scaled
            const rectH = parseFloat(rect.style.height); // Scaled

            const testX = Math.max(rectX, Math.min(circleX, rectX + rectW));
            const testY = Math.max(rectY, Math.min(circleY, rectY + rectH));

            const distX = circleX - testX;
            const distY = circleY - testY;
            const distance = Math.sqrt((distX * distX) + (distY * distY));

            return distance < circleRadius;
        }

        
        // â˜…å¤‰æ›´: å††å½¢åŒå£«ã®è¡çªåˆ¤å®š (ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã•ã‚ŒãŸstyleå€¤ã‚’ä½¿ç”¨)
        function isCircleOverlap(objA, objB, expandRadius = false) {
            const distance = getDistance(objA, objB);
            const radiusA = parseFloat(objA.dataset.radius); // Scaled
            const radiusB = parseFloat(objB.dataset.radius); // Scaled
            
            let combinedRadius = radiusA + radiusB;
            if (expandRadius) {
                combinedRadius *= 1.5; // åˆ¤å®šä¿‚æ•°ã¯ãã®ã¾ã¾
            }

            return distance < combinedRadius;
        }
        
        // â˜…å¤‰æ›´: 2ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸­å¿ƒé–“ã®è·é›¢ (ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã•ã‚ŒãŸstyleå€¤ã‚’ä½¿ç”¨)
        function getDistance(objA, objB) {
            const radiusA = parseFloat(objA.dataset.radius); // Scaled
            const radiusB = parseFloat(objB.dataset.radius); // Scaled
            
            // â˜…å¤‰æ›´: ä¸¡æ–¹ã¨ã‚‚styleã‹ã‚‰åº§æ¨™ã‚’å–å¾—
            const centerAx = parseFloat(objA.style.left) + radiusA; // Scaled
            const centerAy = parseFloat(objA.style.top) + radiusA; // Scaled
            
            const centerBx = parseFloat(objB.style.left) + radiusB; // Scaled
            const centerBy = parseFloat(objB.style.top) + radiusB; // Scaled

            const dx = centerAx - centerBx;
            const dy = centerAy - centerBy;
            return Math.sqrt(dx * dx + dy * dy);
        }

        // --- ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã®ãƒãƒ³ãƒ‰ãƒ© ---
        function handleClear() {
            cancelAnimationFrame(animationFrameId);
            
            levelClearStatus[currentLevelIndex] = true; 
            renderLevelDropdown(); 
            
            showMessage("ã‚¯ãƒªã‚¢ï¼");
            goButton.disabled = true;
            resetButton.disabled = false; 
        }

        function handleFailure() { 
            cancelAnimationFrame(animationFrameId);
            player.classList.add('hit-wall'); 
            setTimeout(resetToStandby, 1000); 
        }

function resetToStandby() {
    gameState = 'standby';
    cancelAnimationFrame(animationFrameId);

    const playerConfig = levels[currentLevelIndex].player;
    player.style.left = `${playerConfig.x * scaleFactor}px`;
    player.style.top = `${playerConfig.y * scaleFactor}px`;
    player.angle = playerConfig.angle;
    player.overlappingBlock = null;
    player.lastDistanceToBlock = Infinity;
    updatePlayerTransform();
    player.classList.remove('hit-wall'); 

    goals.forEach(goal => {
        goal.hit = false;
        goal.style.display = 'flex'; 
    });

    // ğŸ”½ ã“ã“ã‚’è¿½åŠ ï¼
placedBlocks.forEach(block => {
    block.hit = false;
    block.classList.remove('hit');
    block.style.opacity = '1'; // â† ã“ã‚Œã‚’è¿½åŠ 
});

    goButton.disabled = false;
    resetButton.disabled = false;
    hideMessage();
}

        function fullReset() {
             cancelAnimationFrame(animationFrameId);
             clearTrail(); 
             init(currentLevelIndex); // ç¾åœ¨ã®ãƒ¬ãƒ™ãƒ«ã§åˆæœŸåŒ–
        }

        function showMessage(text) {
            messageOverlay.innerHTML = ''; 
            
            if (text === "ã‚¯ãƒªã‚¢ï¼") {
                messageOverlay.classList.add('show'); 
                const messageBox = document.createElement('div');
                messageBox.className = 'message-box';
                
                const messageText = document.createElement('div');
                messageText.textContent = text;
                messageText.style.fontSize = '48px'; 
                messageText.style.fontWeight = 'bold';
                messageBox.appendChild(messageText);

                if (currentLevelIndex < levels.length - 1) {
                    const nextButton = document.createElement('button');
                    nextButton.className = 'button';
                    nextButton.textContent = 'ã¤ãã¸';
                    nextButton.onclick = nextLevel; 
                    messageBox.appendChild(nextButton);
                }
                
                messageOverlay.appendChild(messageBox);
            }
        }

        function hideMessage() {
            messageOverlay.classList.remove('show');
            messageOverlay.innerHTML = ''; 
        }
        
        function nextLevel() {
            hideMessage();
            if (currentLevelIndex < levels.length - 1) {
                init(currentLevelIndex + 1); 
            }
        }

        // --- ãƒ¬ãƒ™ãƒ«é¸æŠUIã®æç”» (ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³) ---
        function renderLevelDropdown() {
            const oldDropdown = document.getElementById('level-dropdown');
            if (oldDropdown) {
                oldDropdown.remove();
            }
            
            const dropdown = document.createElement('select');
            dropdown.id = 'level-dropdown';

            levels.forEach((_, index) => {
                const option = document.createElement('option');
                option.value = index;
                
                const clearedMark = levelClearStatus[index] ? ' â˜…' : '';
                option.textContent = `ã‚‚ã‚“ã ã„ ${index + 1}${clearedMark}`;
                
                if (index === currentLevelIndex) {
                    option.selected = true;
                }
                dropdown.appendChild(option);
            });
            
            dropdown.addEventListener('change', (e) => {
                init(parseInt(e.target.value)); 
            });
            
            levelSelectionDiv.appendChild(dropdown);
        }
        
        // --- è»Œè·¡ã‚¯ãƒªã‚¢ ---
        function clearTrail() {
            playerTrail.forEach(dot => dot.remove());
            playerTrail = [];
        }

        // --- è»Œè·¡æç”» (ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°å¯¾å¿œ) ---
        function updateTrail(x, y) {
            // â˜…å¤‰æ›´: è»Œè·¡ã®ã‚µã‚¤ã‚ºã¨ä½ç½®ã‚‚ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
            const scaledObjectSize = OBJECT_SIZE * scaleFactor;
            const scaledTrailRadius = 1.5 * scaleFactor; // 1.5ã¯è«–ç†åŠå¾„

            const trailDot = document.createElement('div');
            trailDot.className = 'trail';
            trailDot.style.width = `${scaledTrailRadius * 2}px`;
            trailDot.style.height = `${scaledTrailRadius * 2}px`;
            trailDot.style.left = `${x + (scaledObjectSize / 2) - scaledTrailRadius}px`; 
            trailDot.style.top = `${y + (scaledObjectSize / 2) - scaledTrailRadius}px`;
            
            gameBoard.appendChild(trailDot);
            playerTrail.push(trailDot);
        }


        // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š ---
        goButton.addEventListener('click', startGame);
        resetButton.addEventListener('click', fullReset);
        
        // â˜…è¿½åŠ : ãƒªã‚µã‚¤ã‚ºæ™‚ã«ç›¤é¢ã‚’å†åˆæœŸåŒ–
        window.addEventListener('resize', () => {
            init(currentLevelIndex); 
        });

        // --- ã‚²ãƒ¼ãƒ é–‹å§‹ ---
        init(0); // æœ€åˆã®ãƒ¬ãƒ™ãƒ«ã§é–‹å§‹
    </script>
</body>
</html>

