<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éº»é›€ãƒ¡ãƒ³ãƒ„ä½œæˆãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #1a2e1a; /* éº»é›€å“ã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ã—ãŸæ·±ã„ç·‘ */
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            user-select: none;
            touch-action: manipulation;
        }

        .tile {
            width: 50px;
            height: 70px;
            background-color: #f8f8f8;
            border-radius: 4px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem;
            color: #333;
            box-shadow: 0 4px 0 #ccc, 0 6px 10px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
            position: relative;
        }

        .tile:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #ccc, 0 3px 5px rgba(0,0,0,0.3);
        }

        .tile.manzu { color: #d32f2f; }
        .tile.pinzu { color: #1976d2; }
        .tile.souzu { color: #2e7d32; }

        .slot {
            width: 54px;
            height: 74px;
            border: 2px dashed rgba(255,255,255,0.3);
            border-radius: 6px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .set-container {
            border: 3px solid transparent;
            border-radius: 12px;
            padding: 8px;
            transition: border-color 0.3s;
        }

        .set-invalid {
            border-color: #ff5252;
            background-color: rgba(255, 82, 82, 0.1);
        }

        .set-valid {
            border-color: #4caf50;
            background-color: rgba(76, 175, 80, 0.1);
        }

        .pool-area {
            background-color: rgba(0,0,0,0.2);
            border-radius: 16px;
            padding: 20px;
            width: 95%;
            max-width: 600px;
        }
    </style>
</head>
<body>

    <header class="py-6 text-center">
        <h1 class="text-3xl font-bold mb-2">éº»é›€ãƒ¡ãƒ³ãƒ„ä½œæˆ</h1>
        <p id="level-indicator" class="text-sm font-bold text-yellow-400 mb-1">Challenge 1</p>
        <p class="text-xs opacity-80">æŒ‡å®šã•ã‚ŒãŸç‰Œã§3ã¤ã®ãƒ¡ãƒ³ãƒ„ã‚’å®Œæˆã•ã›ã¦ãã ã•ã„</p>
    </header>

    <main class="flex-grow w-full max-w-4xl px-4 flex flex-col items-center">
        <!-- ã‚»ãƒƒãƒˆé…ç½®ã‚¨ãƒªã‚¢ -->
        <div id="game-board" class="flex flex-wrap justify-center gap-6 mb-12">
            <!-- JavaScriptã§ç”Ÿæˆ -->
        </div>

        <!-- æ‰‹ç‰Œãƒ—ãƒ¼ãƒ« -->
        <div class="pool-area shadow-inner">
            <h2 id="pool-title" class="text-center mb-4 text-xs uppercase tracking-widest opacity-50">Available Tiles</h2>
            <div id="tile-pool" class="flex flex-wrap justify-center gap-3">
                <!-- JavaScriptã§ç”Ÿæˆ -->
            </div>
        </div>

        <button id="reset-btn" class="mt-8 px-6 py-2 bg-white/10 hover:bg-white/20 border border-white/30 rounded-full transition-colors">
            ã‚¹ã‚­ãƒƒãƒ— / å†ç”Ÿæˆ
        </button>
    </main>

    <!-- ã‚¯ãƒªã‚¢ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="clear-modal" class="fixed inset-0 bg-black/80 flex items-center justify-center hidden z-50">
        <div class="bg-white text-gray-900 p-8 rounded-2xl text-center max-w-xs w-full">
            <div class="text-6xl mb-4">ğŸ€„</div>
            <h2 class="text-2xl font-bold mb-2">ã‚¯ãƒªã‚¢ï¼</h2>
            <p id="clear-message" class="mb-6">ãŠè¦‹äº‹ï¼ãã‚Œã„ã«æƒã„ã¾ã—ãŸã€‚</p>
            <button id="modal-reset-btn" class="w-full py-3 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 transition-colors">
                æ¬¡ã®å•é¡Œã¸
            </button>
        </div>
    </div>

    <script>
        // éº»é›€ç‰Œã®ãƒ‡ãƒ¼ã‚¿å®šç¾©
        const TILE_TYPES = [
            { id: 'm', name: 'è¬å­', class: 'manzu', icons: ['ğŸ€‡','ğŸ€ˆ','ğŸ€‰','ğŸ€Š','ğŸ€‹','ğŸ€Œ','ğŸ€','ğŸ€','ğŸ€'] },
            { id: 'p', name: 'ç­’å­', class: 'pinzu', icons: ['ğŸ€™','ğŸ€š','ğŸ€›','ğŸ€œ','ğŸ€','ğŸ€','ğŸ€Ÿ','ğŸ€ ','ğŸ€¡'] },
            { id: 's', name: 'ç´¢å­', class: 'souzu', icons: ['ğŸ€','ğŸ€‘','ğŸ€’','ğŸ€“','ğŸ€”','ğŸ€•','ğŸ€–','ğŸ€—','ğŸ€˜'] }
        ];

        let pool = [];
        let slots = [[null, null, null], [null, null, null], [null, null, null]];
        let currentLevel = 1;
        const NUM_SETS = 3;

        // ã‚²ãƒ¼ãƒ åˆæœŸåŒ–
        function initGame() {
            pool = [];
            slots = Array.from({ length: NUM_SETS }, () => [null, null, null]);
            
            if (currentLevel === 1) {
                // ç¬¬1å•: æŒ‡å®šã•ã‚ŒãŸç‰Œã®æ§‹æˆ (1m,1m,1m, 2m,3m,3m, 4m,4m, 5m)
                const activeType = TILE_TYPES[0]; // è¬å­
                const values = [1, 1, 1, 2, 3, 3, 4, 4, 5];
                values.forEach(val => {
                    pool.push({
                        typeId: activeType.id,
                        value: val,
                        icon: activeType.icons[val - 1],
                        class: activeType.class,
                        id: Math.random()
                    });
                });
                document.getElementById('level-indicator').textContent = "Challenge 1 (Fixed Problem)";
                document.getElementById('pool-title').textContent = activeType.name;
            } else {
                // ç¬¬2å•ä»¥é™: ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆ
                const activeType = TILE_TYPES[Math.floor(Math.random() * 3)];
                document.getElementById('level-indicator').textContent = `Challenge ${currentLevel} (Random)`;
                document.getElementById('pool-title').textContent = activeType.name;
                
                for (let i = 0; i < NUM_SETS; i++) {
                    const isKoutsu = Math.random() > 0.5;
                    if (isKoutsu) {
                        const num = Math.floor(Math.random() * 9);
                        for (let j = 0; j < 3; j++) {
                            pool.push({ typeId: activeType.id, value: num + 1, icon: activeType.icons[num], class: activeType.class, id: Math.random() });
                        }
                    } else {
                        const startNum = Math.floor(Math.random() * 7);
                        for (let j = 0; j < 3; j++) {
                            pool.push({ typeId: activeType.id, value: startNum + j + 1, icon: activeType.icons[startNum + j], class: activeType.class, id: Math.random() });
                        }
                    }
                }
            }

            sortPool();
            renderBoard();
            renderPool();
            document.getElementById('clear-modal').classList.add('hidden');
        }

        function sortPool() {
            pool.sort((a, b) => a.value - b.value);
        }

        function renderBoard() {
            const board = document.getElementById('game-board');
            board.innerHTML = '';

            slots.forEach((set, setIdx) => {
                const setContainer = document.createElement('div');
                setContainer.className = 'set-container flex gap-1';
                
                const isFull = set.every(t => t !== null);
                if (isFull) {
                    const isValid = checkSet(set);
                    setContainer.classList.add(isValid ? 'set-valid' : 'set-invalid');
                }

                set.forEach((tile, tileIdx) => {
                    const slot = document.createElement('div');
                    slot.className = 'slot';
                    if (tile) {
                        const tileEl = createTileElement(tile);
                        tileEl.onclick = () => moveFromSlotToPool(setIdx, tileIdx);
                        slot.appendChild(tileEl);
                    }
                    setContainer.appendChild(slot);
                });
                board.appendChild(setContainer);
            });
            checkClear();
        }

        function renderPool() {
            const poolEl = document.getElementById('tile-pool');
            poolEl.innerHTML = '';
            pool.forEach((tile) => {
                const tileEl = createTileElement(tile);
                tileEl.onclick = () => moveFromPoolToSlot(tile);
                poolEl.appendChild(tileEl);
            });
        }

        function createTileElement(tile) {
            const div = document.createElement('div');
            div.className = `tile ${tile.class}`;
            div.textContent = tile.icon;
            return div;
        }

        function moveFromPoolToSlot(tile) {
            for (let i = 0; i < slots.length; i++) {
                for (let j = 0; j < slots[i].length; j++) {
                    if (slots[i][j] === null) {
                        slots[i][j] = tile;
                        pool = pool.filter(p => p.id !== tile.id);
                        renderBoard();
                        renderPool();
                        return;
                    }
                }
            }
        }

        function moveFromSlotToPool(setIdx, tileIdx) {
            const tile = slots[setIdx][tileIdx];
            if (!tile) return;
            slots[setIdx][tileIdx] = null;
            pool.push(tile);
            sortPool();
            renderBoard();
            renderPool();
        }

        function checkSet(tiles) {
            if (tiles.length !== 3) return false;
            const vals = tiles.map(t => t.value).sort((a, b) => a - b);
            // åˆ»å­
            if (vals[0] === vals[1] && vals[1] === vals[2]) return true;
            // é †å­
            if (vals[1] === vals[0] + 1 && vals[2] === vals[1] + 1) return true;
            return false;
        }

        function checkClear() {
            const allFilled = slots.every(set => set.every(t => t !== null));
            if (!allFilled) return;
            const allValid = slots.every(set => checkSet(set));
            if (allValid) {
                setTimeout(() => {
                    document.getElementById('clear-modal').classList.remove('hidden');
                }, 400);
            }
        }

        document.getElementById('reset-btn').onclick = () => {
            currentLevel++;
            initGame();
        };
        document.getElementById('modal-reset-btn').onclick = () => {
            currentLevel++;
            initGame();
        };

        window.onload = initGame;
    </script>
</body>
</html>