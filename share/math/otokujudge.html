<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãŠå¾—ã‚¸ãƒ£ãƒƒã‚¸ã‚²ãƒ¼ãƒ </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
        }
        .price-tag {
            background-color: #ffefa6;
            border: 2px solid #f9c941;
            box-shadow: 4px 4px 0 #f9c941;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .price-tag:hover {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 #f9c941;
        }
        .price-tag.selected {
            transform: translate(4px, 4px);
            box-shadow: 0 0 0 #f9c941;
        }
        .price-tag.correct {
            animation:-webkit-box-shadow 2s, 0, 1;
            -webkit-animation: flash 1s ease-out;
            -moz-animation: flash 1s ease-out;
            -o-animation: flash 1s ease-out;
            animation: flash 1s ease-out;
            background-color: #a7f3d0; /* green-200 */
            border-color: #34d399; /* green-400 */
            box-shadow: 4px 4px 0 #34d399;
        }
        .price-tag.incorrect {
            background-color: #fecaca; /* red-200 */
            border-color: #f87171; /* red-400 */
            box-shadow: 4px 4px 0 #f87171;
        }

        @keyframes flash {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .result-card {
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
    </style>
</head>
<body class="bg-amber-50 text-gray-800 flex items-center justify-center min-h-screen p-4">

    <div id="game-container" class="w-full max-w-2xl mx-auto text-center">
        <header class="mb-6">
            <h1 class="text-4xl font-bold text-amber-600 mb-2">ãŠå¾—åˆ¤æ–­ã‚²ãƒ¼ãƒ </h1>
            <p class="text-lg text-gray-600">ä¸€ç•ªãŠè²·ã„å¾—ãªã®ã¯ã©ã‚Œï¼Ÿ</p>
            <div id="progress-bar" class="w-full bg-gray-200 rounded-full h-4 mt-4 overflow-hidden">
                <div id="progress" class="bg-green-500 h-4 rounded-full" style="width: 0%;"></div>
            </div>
            <p id="question-counter" class="text-sm text-gray-500 mt-1"></p>
        </header>

        <main id="main-content">
            <div id="price-tags-container" class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
                <!-- å€¤æœ­ã¯ã“ã“ã«JavaScriptã§ç”Ÿæˆã•ã‚Œã¾ã™ -->
            </div>
        </main>

        <!-- çµæœè¡¨ç¤ºç”¨ã®ãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div id="result-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 hidden">
            <div class="result-card bg-white/80 rounded-2xl shadow-xl p-6 md:p-8 w-full max-w-md text-center transform transition-all duration-300 scale-95 opacity-0">
                <h2 id="result-title" class="text-5xl font-bold mb-4"></h2>
                <div id="result-explanation" class="text-left bg-white rounded-lg p-4 mb-6 space-y-2">
                    <!-- è§£èª¬ã¯ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                </div>
                <button id="next-button" class="w-full bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-4 rounded-lg text-xl transition-transform duration-200 hover:scale-105">
                    æ¬¡ã®å•é¡Œã¸
                </button>
            </div>
        </div>
    </div>

    <script>
        const gameData = [
            // å•é¡Œãƒ‡ãƒ¼ã‚¿ (6å•)
            [{grams: 100, price: 150}, {grams: 200, price: 310}, {grams: 300, price: 440}],
            [{grams: 200, price: 220}, {grams: 300, price: 360}, {grams: 400, price: 480}],
            [{grams: 80, price: 100}, {grams: 120, price: 140}, {grams: 200, price: 260}],
            [{grams: 500, price: 450}, {grams: 600, price: 550}, {grams: 700, price: 650}],
            [{grams: 180, price: 200}, {grams: 240, price: 250}, {grams: 300, price: 320}],
            [{grams: 350, price: 400}, {grams: 420, price: 490}, {grams: 560, price: 650}]
        ];

        let currentQuestionIndex = 0;
        let score = 0;
        let isAnswering = false;

        const priceTagsContainer = document.getElementById('price-tags-container');
        const resultModal = document.getElementById('result-modal');
        const resultTitle = document.getElementById('result-title');
        const resultExplanation = document.getElementById('result-explanation');
        const nextButton = document.getElementById('next-button');
        const questionCounter = document.getElementById('question-counter');
        const progressBar = document.getElementById('progress');

        // ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ã®äº’é™¤æ³•ã§æœ€å¤§å…¬ç´„æ•°ã‚’æ±‚ã‚ã‚‹
        const gcd = (a, b) => (b === 0 ? a : gcd(b, a % b));
        const findGCD = (arr) => arr.reduce((a, b) => gcd(a, b));

        function displayQuestion() {
            isAnswering = false;
            priceTagsContainer.innerHTML = '';
            const question = gameData[currentQuestionIndex];

            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã¨ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’æ›´æ–°
            const progressPercentage = ((currentQuestionIndex) / gameData.length) * 100;
            progressBar.style.width = `${progressPercentage}%`;
            questionCounter.textContent = `ç¬¬ ${currentQuestionIndex + 1} å• / ${gameData.length} å•`;

            question.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'price-tag p-6 rounded-xl cursor-pointer';
                card.innerHTML = `
                    <div class="text-4xl font-bold">${item.grams}g</div>
                    <div class="text-5xl font-extrabold text-red-600 mt-2">${item.price}<span class="text-3xl">å††</span></div>
                `;
                card.dataset.index = index;
                card.addEventListener('click', handleCardClick);
                priceTagsContainer.appendChild(card);
            });
        }

        function handleCardClick(event) {
            if (isAnswering) return;
            isAnswering = true;

            const selectedIndex = parseInt(event.currentTarget.dataset.index);
            event.currentTarget.classList.add('selected');
            checkAnswer(selectedIndex);
        }

        function checkAnswer(selectedIndex) {
            const question = gameData[currentQuestionIndex];
            const gramsArray = question.map(item => item.grams);
            const commonDivisor = findGCD(gramsArray);

            const pricesPerUnit = question.map(item => {
                return {
                    ...item,
                    unitPrice: (item.price / item.grams) * commonDivisor
                };
            });

            // æœ€ã‚‚å˜ä¾¡ãŒå®‰ã„ã‚‚ã®ã‚’è¦‹ã¤ã‘ã‚‹
            const bestDeal = pricesPerUnit.reduce((prev, current) => (prev.unitPrice < current.unitPrice) ? prev : current);
            const correctIndex = question.findIndex(item => item.grams === bestDeal.grams && item.price === bestDeal.price);

            const isCorrect = selectedIndex === correctIndex;
            if (isCorrect) {
                score++;
            }

            setTimeout(() => {
                showResult(isCorrect, pricesPerUnit, commonDivisor, selectedIndex, correctIndex);
            }, 500);
        }

        function showResult(isCorrect, pricesPerUnit, commonDivisor, selectedIndex, correctIndex) {
            // ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
            resultModal.classList.remove('hidden');
            setTimeout(() => {
                const card = resultModal.querySelector('.result-card');
                card.classList.remove('scale-95', 'opacity-0');
                card.classList.add('scale-100', 'opacity-100');
            }, 10);

            // æ­£è§£ãƒ»ä¸æ­£è§£ã®ã‚¿ã‚¤ãƒˆãƒ«ã¨è‰²è¨­å®š
            if (isCorrect) {
                resultTitle.textContent = 'æ­£è§£ï¼';
                resultTitle.className = 'text-5xl font-bold mb-4 text-green-500';
            } else {
                resultTitle.textContent = 'æ®‹å¿µï¼';
                resultTitle.className = 'text-5xl font-bold mb-4 text-red-500';
            }
            
            // è§£èª¬ã®ç”Ÿæˆ
            let explanationHTML = `<p class="font-bold text-lg mb-3">ã€è§£èª¬ã€‘</p><p class="mb-3 text-sm text-gray-600">ã‚°ãƒ©ãƒ æ•°ã‚’æœ€å¤§å…¬ç´„æ•°ã® <span class="font-bold text-amber-600">${commonDivisor}g</span> ã«æƒãˆã¦è¨ˆç®—ã™ã‚‹ã¨...</p>`;
            pricesPerUnit.forEach((item, index) => {
                let highlightClass = '';
                if(index === correctIndex) highlightClass = 'bg-green-100 font-bold';
                if(index === selectedIndex && index !== correctIndex) highlightClass = 'bg-red-100';

                explanationHTML += `
                    <div class="p-2 rounded-md ${highlightClass}">
                        ${item.grams}g ${item.price}å†† â†’ <span class="font-bold text-xl text-red-600">${item.unitPrice.toFixed(1)}å††</span>
                        ${index === correctIndex ? '<span class="text-green-600 font-bold ml-2">ğŸ‰ãŠå¾—ï¼</span>' : ''}
                    </div>
                `;
            });
            resultExplanation.innerHTML = explanationHTML;
            
            // ã‚«ãƒ¼ãƒ‰ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ
            const cards = document.querySelectorAll('.price-tag');
            cards.forEach((card, index) => {
                card.removeEventListener('click', handleCardClick); // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤
                if (index === correctIndex) {
                    card.classList.add('correct');
                } else if (index === selectedIndex) {
                    card.classList.add('incorrect');
                }
            });

            // æ¬¡ã®ãƒœã‚¿ãƒ³ã®è¨­å®š
            currentQuestionIndex++;
            if (currentQuestionIndex < gameData.length) {
                nextButton.textContent = 'æ¬¡ã®å•é¡Œã¸';
                nextButton.onclick = hideResultAndNext;
            } else {
                nextButton.textContent = 'çµæœã‚’è¦‹ã‚‹';
                nextButton.onclick = showFinalScore;
            }
        }

        function hideResultAndNext() {
            const card = resultModal.querySelector('.result-card');
            card.classList.add('scale-95', 'opacity-0');
            card.classList.remove('scale-100', 'opacity-100');
            setTimeout(() => {
                resultModal.classList.add('hidden');
                displayQuestion();
            }, 300);
        }

        function showFinalScore() {
            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’100%ã«
            progressBar.style.width = `100%`;
            
            resultTitle.textContent = 'æœ€çµ‚çµæœ';
            resultTitle.className = 'text-5xl font-bold mb-4 text-amber-600';
            
            resultExplanation.innerHTML = `
                <p class="text-2xl text-center">ã‚ãªãŸã¯...</p>
                <p class="text-6xl text-center font-bold my-4">${gameData.length}å•ä¸­ <span class="text-green-500">${score}å•</span> æ­£è§£ï¼</p>
                <p class="text-center text-gray-600">${getFinalMessage()}</p>
            `;
            
            nextButton.textContent = 'ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ã™ã‚‹';
            nextButton.onclick = () => {
                location.reload(); // ç°¡å˜ãªãƒªã‚»ãƒƒãƒˆæ–¹æ³•ã¨ã—ã¦ãƒªãƒ­ãƒ¼ãƒ‰
            };
        }

        function getFinalMessage() {
            const percentage = score / gameData.length;
            if (percentage === 1) return "ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆï¼ã‚ãªãŸã¯ãŠè²·ã„ç‰©ã®é”äººã§ã™ã­ï¼";
            if (percentage >= 0.8) return "ç´ æ™´ã‚‰ã—ã„ï¼ã»ã¨ã‚“ã©è¦‹æŠœã‘ã‚‹ãŠè²·ã„ç‰©ä¸Šæ‰‹ï¼";
            if (percentage >= 0.5) return "ãªã‹ãªã‹è‰¯ã„ã§ã™ã­ï¼ã‚‚ã†å°‘ã—ã§é”äººã®åŸŸã§ã™ï¼";
            return "ã¾ãŸæŒ‘æˆ¦ã—ã¦ã€ãŠå¾—ã®æ„Ÿè¦šã‚’ç£¨ãã¾ã—ã‚‡ã†ï¼";
        }

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        document.addEventListener('DOMContentLoaded', displayQuestion);
    </script>
</body>
</html>
