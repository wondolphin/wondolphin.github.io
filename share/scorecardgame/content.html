<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Color Card Logic Game</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: #333;
        }

        h1 {
            margin-bottom: 10px;
        }

        #game-info {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 600px;
            width: 100%;
            margin-bottom: 20px;
        }

        .info-row {
            margin: 10px 0;
            font-size: 1.1em;
        }

        .score-display {
            font-weight: bold;
            color: #e74c3c;
            font-size: 1.4em;
        }

        #card-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            min-height: 200px;
            align-items: center;
        }

        .card {
            width: 80px;
            height: 120px;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            transition: transform 0.2s, box-shadow 0.2s, background-color 0.3s;
            user-select: none;
            color: transparent; /* 初期状態では数字を見せない */
            border: 4px solid white;
        }

        .card:hover:not(.revealed) { /* 未選択のカードのみホバーを許可 */
            transform: translateY(-5px);
            box-shadow: 0 8px 12px rgba(0,0,0,0.3);
        }

        .card.revealed {
            color: inherit; /* 色を戻して数字を表示 */
            cursor: default;
            transform: none;
        }

        /* テキスト色調整（背景色によって見やすくする） */
        .text-white { color: white !important; }
        .text-black { color: black !important; }

        /* 状態メッセージ */
        #status-message {
            margin-top: 20px;
            font-weight: bold;
            min-height: 1.2em;
        }
        
        /* コントロールボタン */
        .control-buttons {
            margin-top: 20px;
        }

        .control-buttons button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #333;
            color: white;
            border: none;
            border-radius: 5px;
            margin: 0 10px;
        }

        #next-set-btn {
            display: none; /* 初期状態は非表示 */
            background-color: #28a745; /* 次へボタンは緑色に */
        }
        
        #restart-btn {
            display: none; /* 初期状態は非表示 */
        }
    </style>
</head>
<body>

    <h1>スコア選択ゲーム</h1>

    <div id="game-info">
        <div class="info-row">
            現在のセット: <span id="current-set">1</span> / 8
        </div>
        <div class="info-row">
            このセットに含まれる点数: <br>
            <strong id="available-scores">---</strong>
        </div>
        <div class="info-row">
            合計スコア: <span id="total-score" class="score-display">0</span>
        </div>
    </div>

    <div id="card-container">
        <!-- カードがここに生成されます -->
    </div>

    <div id="status-message">カードを選んでください</div>

    <div class="control-buttons">
        <button id="next-set-btn">次へ進む</button>
        <button id="restart-btn">もう一度遊ぶ</button>
    </div>

    <script>
        // ゲームデータ定義
        const setsData = [
            [1, 2, 3],
            [2, 3, 4],
            [1, 2, 4, 5],
            [0, 2, 3, 5],
            [-1, 0, 3, 4],
            [-3, -2, 1, 3, 5],
            [-2, -1, 1, 2, 3, 4, 7],
            [-2, -1, 0, 2, 3, 4, 8]
        ];

        // 状態変数
        let currentSetIndex = 0;
        let totalScore = 0;
        let isProcessing = false; // セット進行中のフラグ

        // 色の定義マップ (余り: 色コード)
        // 0:赤, 1:紫, 2:藍(明るく変更), 3:青, 4:緑, 5:黄, 6:オレンジ
        const colorMap = {
            0: { bg: '#FF4136', text: 'text-white' }, // Red
            1: { bg: '#B10DC9', text: 'text-white' }, // Purple
            2: { bg: '#6549FE', text: 'text-white' }, // Indigo
            3: { bg: '#00B0ED', text: 'text-white' }, // Blue
            4: { bg: '#2ECC40', text: 'text-black' }, // Green
            5: { bg: '#FFDC00', text: 'text-black' }, // Yellow
            6: { bg: '#FF851B', text: 'text-black' }  // Orange
        };
        
        // DOM要素のキャッシュ
        const setDisplay = document.getElementById('current-set');
        const availScoresDisplay = document.getElementById('available-scores');
        const container = document.getElementById('card-container');
        const message = document.getElementById('status-message');
        const totalScoreDisplay = document.getElementById('total-score');
        const nextSetBtn = document.getElementById('next-set-btn');
        const restartBtn = document.getElementById('restart-btn');

        // 初期化
        function initGame() {
            currentSetIndex = 0;
            totalScore = 0;
            isProcessing = false;
            restartBtn.style.display = 'none';
            nextSetBtn.style.display = 'none';
            totalScoreDisplay.innerText = '0';
            updateGameView();
        }

        // モジュロ演算（負の数も正の余りに変換）
        function getMod7(n) {
            return ((n % 7) + 7) % 7;
        }

        // 配列をシャッフルする関数
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // 画面描画
        function updateGameView() {
            // ゲーム終了判定
            if (currentSetIndex >= setsData.length) {
                container.innerHTML = '';
                setDisplay.innerText = '-';
                availScoresDisplay.innerText = '-';
                message.innerText = `ゲーム終了！最終スコアは ${totalScore} 点です。`;
                restartBtn.style.display = 'block';
                nextSetBtn.style.display = 'none';
                return;
            }

            // 現在のセット情報更新
            setDisplay.innerText = currentSetIndex + 1;
            
            // 点数リストを表示（ユーザーへのヒントとしてソートして表示）
            const currentScores = setsData[currentSetIndex];
            const sortedScoresText = [...currentScores].sort((a, b) => a - b).join(', ');
            availScoresDisplay.innerText = sortedScoresText;

            message.innerText = 'カードを選んでください';
            isProcessing = false; // クリック可能にする
            nextSetBtn.style.display = 'none'; // 「次へ」ボタンを隠す

            // カード生成（ランダム配置）
            container.innerHTML = '';
            const shuffledScores = shuffleArray(currentScores);

            shuffledScores.forEach(score => {
                const card = document.createElement('div');
                card.className = 'card';
                
                // 色の決定ロジック
                const remainder = getMod7(score);
                const styleData = colorMap[remainder];
                
                card.style.backgroundColor = styleData.bg;
                // データ属性に保存
                card.dataset.textColorClass = styleData.text; 
                card.dataset.score = score; // スコアもデータ属性に保存

                // クリックイベント
                card.onclick = () => handleCardClick(card);

                // HTML上には数字を持たせておく（表示はCSSで隠す）
                card.innerText = score;

                container.appendChild(card);
            });
        }

        // カードクリック時の処理
        function handleCardClick(clickedCard) {
            // isProcessingがtrue（=1枚選択済み）なら何もしない
            if (isProcessing) return; 
            
            isProcessing = true; // 1枚選んだので処理中フラグを立てる
            
            const score = parseInt(clickedCard.dataset.score, 10);

            // スコア加算
            totalScore += score;
            totalScoreDisplay.innerText = totalScore;

            // メッセージ更新
            message.innerText = `${score}点を獲得しました！`;

            // すべてのカードを開く
            const allCards = document.querySelectorAll('.card');
            allCards.forEach(card => {
                card.classList.add('revealed');
                card.classList.add(card.dataset.textColorClass); // 文字色を適用
            });
            
            // 「次へ」ボタンを表示
            // (最終セットの場合は表示しない)
            if (currentSetIndex < setsData.length - 1) {
                nextSetBtn.style.display = 'block';
            } else {
                // 最終セットが終わった場合
                setTimeout(() => {
                    currentSetIndex++;
                    updateGameView(); // 終了処理を呼び出す
                }, 1500); // 結果を少し表示してから終了
            }
        }
        
        // 「次へ」ボタンの処理
        nextSetBtn.addEventListener('click', () => {
            if (!isProcessing) return; // カードが選択される前は無効

            currentSetIndex++;
            updateGameView();
        });
        
        // 「リスタート」ボタンの処理
        restartBtn.addEventListener('click', initGame);

        // ゲーム開始
        initGame();

    </script>
</body>
</html>